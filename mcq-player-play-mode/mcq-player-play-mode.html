<link rel="import" href="../../polymer/polymer-element.html">
<link rel="import" href="showdown-import.html">
<link rel="import" href="jquery-import.html">
<link rel="import" href="../../paper-radio-button/paper-radio-button.html">
<link rel="import" href="../../paper-radio-group/paper-radio-group.html">
<link rel="import" href="../../paper-toolbar/paper-toolbar.html">


<dom-module id="mcq-player-play-mode">
  <template>
    <style>
      @import url('https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800');
      :host {
        display: block;
        height: 100%;
        width: 100%;
        background: white;
        font-family: 'Open Sans', sans-serif !important;
        padding: 10px;
      }
      
      .option {
        display: inline-block;
        vertical-align: top;
      }

      paper-toolbar.black {
        --paper-toolbar-background: black;
      }

      paper-radio-button {
        padding-top: 20px;
      }
    </style>
    <paper-toolbar class="black">
      <span slot="top" class="title">Multiple Choice Question</span>
    </paper-toolbar>
    <h1>Question</h1>
    <div id="question"></div>
    <h1>Instructions</h1>
    <div id="instructions"></div>
    <h1>Options</h1>
    <paper-radio-group id="options">
      
    </paper-radio-group>
  </template>

  <script>
    class McqPlayerPlayMode extends Polymer.Element {
      static get is() { return 'mcq-player-play-mode'; }
      static get properties() {
        return {
          assessmentItem: {
            type: Object,
            notify: true
          },
          mdAssessmentItem: {
            type: String,
            observers: 'assessmentItemChanged',
            value: `# Question\nWhat is react\n# Instructions\nGo over there\n# Option-1\nThis is Option 1\n# Option 2\n## This is Option 2`
          }
        };
      }

      static get observers() {
        return [
          'assessmentItemChanged(mdAssessmentItem)'
        ]
      }

      constructor() {
        super();
        this.convertor = new showdown.Converter();
        this.options = [];  
      }

      connectedCallback() {
        super.connectedCallback();
        this._initialize();
      }

      _initialize() {
        
      }

      assessmentItemChanged(mdAssessmentItem) {
        const htmlTemplate = this.convertor.makeHtml(mdAssessmentItem);
        const htmlElement = document.createElement('div');
        htmlElement.innerHTML = htmlTemplate;
        
        const h1Elements = jQuery(htmlElement).find('h1').toArray();
        const contents = h1Elements.map((h1Element, index) => {
          let siblings;
          if(index != h1Elements.length) {
            siblings = jQuery(h1Element).nextUntil(jQuery(h1Elements[index + 1])[0]);
          } else {
            siblings = jQuery(h1Element).nextAll();
          }
          return siblings;
        });
        
        jQuery(this.$.question).empty().append(contents[0]);
        jQuery(this.$.instructions).empty().append(contents[1]);
        const optionTemplate = `<paper-radio-button></paper-radio-button><div class="option"></div>`;
          const options = contents.splice(2, contents.length - 2).map((option) => {
            const optionElement = document.createElement('div');
            optionElement.innerHTML = optionTemplate;
            const radioButton = jQuery(jQuery(optionElement).find('paper-radio-button')[0]); 
            const radioButtonContent = jQuery(jQuery(optionElement).find('.option')[0]).html(option);
            console.log(radioButtonContent);
            radioButtonContent.insertAfter(radioButton);
            return optionElement;
        });
        jQuery(this.$.options).empty().append(options);
      }
    }

    window.customElements.define(McqPlayerPlayMode.is, McqPlayerPlayMode);
  </script>
</dom-module>
